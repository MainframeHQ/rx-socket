import { createServer } from 'net'
import { EOL } from 'os'
import { join } from 'path'

import { SocketSubject } from '../src'

const randomString = () => {
  return Math.random()
    .toString(36)
    .slice(2, 10)
}

const createSocketServer = listener => {
  const path = join(process.cwd(), randomString())
  const server = createServer(listener)
  const close = cb => {
    server.close(cb)
  }
  return new Promise((resolve, reject) => {
    console.log('server listen', path)
    server.listen(path, err => {
      console.log('server started?', err)
      if (err) reject(err)
      else resolve({ close, path })
    })
  })
}

describe('rx-socket', () => {
  // it.only('connects to the server when subscribed', async () => {
  //   const server = await createSocketServer(s => {
  //     setTimeout(() => {
  //       console.log('test server sends message')
  //       s.write(JSON.stringify({ ok: true }))
  //     }, 100)
  //   })
  //   const socket = new SocketSubject(server.path)
  //   return new Promise(resolve => {
  //     console.log('client subscribes')
  //     socket.subscribe(msg => {
  //       console.log('client subscription message', msg)
  //       expect(msg.ok).toBe(true)
  //       server.close()
  //       resolve()
  //     })
  //   })
  // })

  // it.only('sends JSON objects', () => {
  //   return new Promise(async resolve => {
  //     const server = await createSocketServer(s => {
  //       s.on('data', chunk => {
  //         expect(chunk.toString()).toBe('{"ok":true}')
  //         resolve()
  //       })
  //     })
  //     const socket = new SocketSubject(server.path)
  //     socket.next({ ok: true })
  //     socket.subscribe()
  //   })
  // })

  it.only('accepts a config object with open and close observers', () => {
    const nextOpen = jest.fn()
    return new Promise(async resolve => {
      const server = await createSocketServer(s => {
        s.write(JSON.stringify({ ok: true }))
      })
      const socket = new SocketSubject({
        path: server.path,
        openObserver: {
          next: nextOpen,
        },
        closeObserver: {
          next: () => {
            expect(nextOpen).toHaveBeenCalled()
            resolve()
          },
        },
      })
      socket.subscribe(() => {
        socket.unsubscribe()
        server.close()
      })
    })
  })
})

// const multiFrameMessage =
//   'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est. Morbi sit amet mi massa. Mauris quis tincidunt dui, vel efficitur ligula. Integer ac mauris sed justo condimentum tincidunt sit amet eget ante. In vitae rhoncus augue. Nulla et mattis libero. Suspendisse vitae lacus et nulla cursus ultrices. Maecenas ultrices est nec consequat feugiat. Vivamus rutrum velit ac rutrum cursus. Vivamus finibus ut erat eleifend dictum. Quisque interdum velit et justo consectetur, non ornare eros aliquet. Vivamus varius mauris volutpat, blandit dui nec, rutrum ex. Nunc faucibus laoreet velit eu imperdiet. In purus nulla, lobortis at lectus quis, vulputate imperdiet ipsum. Donec quis luctus risus. Quisque eleifend urna id gravida imperdiet. Maecenas eget lectus felis. Aliquam euismod bibendum risus. Vestibulum eget viverra sem. Donec eros justo, sollicitudin condimentum porttitor sit amet, venenatis eget arcu. Aenean lacinia est sed est iaculis mattis. Ut ligula lorem, lobortis quis aliquam at, ultrices at massa. In sit amet magna sit amet justo convallis tristique. Aenean elementum dignissim purus ut dictum. Integer eget fermentum ante. In hac habitasse platea dictumst. Proin vel interdum neque. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Proin consequat fringilla felis et mollis. Aenean metus dui, iaculis cursus feugiat et, placerat vel magna. Ut id dui sed orci sollicitudin suscipit. Vestibulum molestie pretium dui eu lacinia. Aenean diam elit, hendrerit vitae lorem at, cursus elementum nibh. Pellentesque convallis id lorem ac tristique. Morbi sit amet metus hendrerit, dignissim felis id, rutrum sem. Nunc pulvinar tincidunt molestie. Nullam rhoncus, erat quis vehicula rutrum, mauris ex pulvinar lectus, volutpat sollicitudin dolor ligula vitae augue. Quisque sapien nibh, aliquam in hendrerit a, ultricies eget lectus. Nam commodo interdum arcu, quis eleifend metus vulputate ac. Vestibulum ut malesuada odio. Sed in magna sed tellus dictum ultrices. Nam ut leo suscipit, accumsan erat et, molestie velit. Morbi eu dignissim nisl. Donec finibus enim sed sem dictum vestibulum. Aenean tincidunt nisl lacus, ut bibendum lectus bibendum ac. Nulla molestie nisl arcu, eget venenatis urna volutpat malesuada. Aliquam erat volutpat. Nullam tempus nibh in augue lacinia, vel dictum eros tempor. Nunc id urna sit amet quam rutrum tempor sed sed mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est. Morbi sit amet mi massa. Mauris quis tincidunt dui, vel efficitur ligula. Integer ac mauris sed justo condimentum tincidunt sit amet eget ante. In vitae rhoncus augue. Nulla et mattis libero. Suspendisse vitae lacus et nulla cursus ultrices. Maecenas ultrices est nec consequat feugiat. Vivamus rutrum velit ac rutrum cursus. Vivamus finibus ut erat eleifend dictum. Quisque interdum velit et justo consectetur, non ornare eros aliquet. Vivamus varius mauris volutpat, blandit dui nec, rutrum ex. Nunc faucibus laoreet velit eu imperdiet. In purus nulla, lobortis at lectus quis, vulputate imperdiet ipsum. Donec quis luctus risus. Quisque eleifend urna id gravida imperdiet. Maecenas eget lectus felis. Aliquam euismod bibendum risus. Vestibulum eget viverra sem. Donec eros justo, sollicitudin condimentum porttitor sit amet, venenatis eget arcu. Aenean lacinia est sed est iaculis mattis. Ut ligula lorem, lobortis quis aliquam at, ultrices at massa. In sit amet magna sit amet justo convallis tristique. Aenean elementum dignissim purus ut dictum. Integer eget fermentum ante. In hac habitasse platea dictumst. Proin vel interdum neque. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Proin consequat fringilla felis et mollis. Aenean metus dui, iaculis cursus feugiat et, placerat vel magna. Ut id dui sed orci sollicitudin suscipit. Vestibulum molestie pretium dui eu lacinia. Aenean diam elit, hendrerit vitae lorem at, cursus elementum nibh. Pellentesque convallis id lorem ac tristique. Morbi sit amet metus hendrerit, dignissim felis id, rutrum sem. Nunc pulvinar tincidunt molestie. Nullam rhoncus, erat quis vehicula rutrum, mauris ex pulvinar lectus, volutpat sollicitudin dolor ligula vitae augue. Quisque sapien nibh, aliquam in hendrerit a, ultricies eget lectus. Nam commodo interdum arcu, quis eleifend metus vulputate ac. Vestibulum ut malesuada odio. Sed in magna sed tellus dictum ultrices. Nam ut leo suscipit, accumsan erat et, molestie velit. Morbi eu dignissim nisl. Donec finibus enim sed sem dictum vestibulum. Aenean tincidunt nisl lacus, ut bibendum lectus bibendum ac. Nulla molestie nisl arcu, eget venenatis urna volutpat malesuada. Aliquam erat volutpat. Nullam tempus nibh in augue lacinia, vel dictum eros tempor. Nunc id urna sit amet quam rutrum tempor sed sed mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est. Morbi sit amet mi massa. Mauris quis tincidunt dui, vel efficitur ligula. Integer ac mauris sed justo condimentum tincidunt sit amet eget ante. In vitae rhoncus augue. Nulla et mattis libero. Suspendisse vitae lacus et nulla cursus ultrices. Maecenas ultrices est nec consequat feugiat. Vivamus rutrum velit ac rutrum cursus. Vivamus finibus ut erat eleifend dictum. Quisque interdum velit et justo consectetur, non ornare eros aliquet. Vivamus varius mauris volutpat, blandit dui nec, rutrum ex. Nunc faucibus laoreet velit eu imperdiet. In purus nulla, lobortis at lectus quis, vulputate imperdiet ipsum. Donec quis luctus risus. Quisque eleifend urna id gravida imperdiet. Maecenas eget lectus felis. Aliquam euismod bibendum risus. Vestibulum eget viverra sem. Donec eros justo, sollicitudin condimentum porttitor sit amet, venenatis eget arcu. Aenean lacinia est sed est iaculis mattis. Ut ligula lorem, lobortis quis aliquam at, ultrices at massa. In sit amet magna sit amet justo convallis tristique. Aenean elementum dignissim purus ut dictum. Integer eget fermentum ante. In hac habitasse platea dictumst. Proin vel interdum neque. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Proin consequat fringilla felis et mollis. Aenean metus dui, iaculis cursus feugiat et, placerat vel magna. Ut id dui sed orci sollicitudin suscipit. Vestibulum molestie pretium dui eu lacinia. Aenean diam elit, hendrerit vitae lorem at, cursus elementum nibh. Pellentesque convallis id lorem ac tristique. Morbi sit amet metus hendrerit, dignissim felis id, rutrum sem. Nunc pulvinar tincidunt molestie. Nullam rhoncus, erat quis vehicula rutrum, mauris ex pulvinar lectus, volutpat sollicitudin dolor ligula vitae augue. Quisque sapien nibh, aliquam in hendrerit a, ultricies eget lectus. Nam commodo interdum arcu, quis eleifend metus vulputate ac. Vestibulum ut malesuada odio. Sed in magna sed tellus dictum ultrices. Nam ut leo suscipit, accumsan erat et, molestie velit. Morbi eu dignissim nisl. Donec finibus enim sed sem dictum vestibulum. Aenean tincidunt nisl lacus, ut bibendum lectus bibendum ac. Nulla molestie nisl arcu, eget venenatis urna volutpat malesuada. Aliquam erat volutpat. Nullam tempus nibh in augue lacinia, vel dictum eros tempor. Nunc id urna sit amet quam rutrum tempor sed sed mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est. Morbi sit amet mi massa. Mauris quis tincidunt dui, vel efficitur ligula. Integer ac mauris sed justo condimentum tincidunt sit amet eget ante. In vitae rhoncus augue. Nulla et mattis libero. Suspendisse vitae lacus et nulla cursus ultrices. Maecenas ultrices est nec consequat feugiat. Vivamus rutrum velit ac rutrum cursus. Vivamus finibus ut erat eleifend dictum. Quisque interdum velit et justo consectetur, non ornare eros aliquet. Vivamus varius mauris volutpat, blandit dui nec, rutrum ex. Nunc faucibus laoreet velit eu imperdiet. In purus nulla, lobortis at lectus quis, vulputate imperdiet ipsum. Donec quis luctus risus. Quisque eleifend urna id gravida imperdiet. Maecenas eget lectus felis. Aliquam euismod bibendum risus. Vestibulum eget viverra sem. Donec eros justo, sollicitudin condimentum porttitor sit amet, venenatis eget arcu. Aenean lacinia est sed est iaculis mattis. Ut ligula lorem, lobortis quis aliquam at, ultrices at massa. In sit amet magna sit amet justo convallis tristique. Aenean elementum dignissim purus ut dictum. Integer eget fermentum ante. In hac habitasse platea dictumst. Proin vel interdum neque. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Proin consequat fringilla felis et mollis. Aenean metus dui, iaculis cursus feugiat et, placerat vel magna. Ut id dui sed orci sollicitudin suscipit. Vestibulum molestie pretium dui eu lacinia. Aenean diam elit, hendrerit vitae lorem at, cursus elementum nibh. Pellentesque convallis id lorem ac tristique. Morbi sit amet metus hendrerit, dignissim felis id, rutrum sem. Nunc pulvinar tincidunt molestie. Nullam rhoncus, erat quis vehicula rutrum, mauris ex pulvinar lectus, volutpat sollicitudin dolor ligula vitae augue. Quisque sapien nibh, aliquam in hendrerit a, ultricies eget lectus. Nam commodo interdum arcu, quis eleifend metus vulputate ac. Vestibulum ut malesuada odio. Sed in magna sed tellus dictum ultrices. Nam ut leo suscipit, accumsan erat et, molestie velit. Morbi eu dignissim nisl. Donec finibus enim sed sem dictum vestibulum. Aenean tincidunt nisl lacus, ut bibendum lectus bibendum ac. Nulla molestie nisl arcu, eget venenatis urna volutpat malesuada. Aliquam erat volutpat. Nullam tempus nibh in augue lacinia, vel dictum eros tempor. Nunc id urna sit amet quam rutrum tempor sed sed mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est. Morbi sit amet mi massa. Mauris quis tincidunt dui, vel efficitur ligula. Integer ac mauris sed justo condimentum tincidunt sit amet eget ante. In vitae rhoncus augue. Nulla et mattis libero. Suspendisse vitae lacus et nulla cursus ultrices. Maecenas ultrices est nec consequat feugiat. Vivamus rutrum velit ac rutrum cursus. Vivamus finibus ut erat eleifend dictum. Quisque interdum velit et justo consectetur, non ornare eros aliquet. Vivamus varius mauris volutpat, blandit dui nec, rutrum ex. Nunc faucibus laoreet velit eu imperdiet. In purus nulla, lobortis at lectus quis, vulputate imperdiet ipsum. Donec quis luctus risus. Quisque eleifend urna id gravida imperdiet. Maecenas eget lectus felis. Aliquam euismod bibendum risus. Vestibulum eget viverra sem. Donec eros justo, sollicitudin condimentum porttitor sit amet, venenatis eget arcu. Aenean lacinia est sed est iaculis mattis. Ut ligula lorem, lobortis quis aliquam at, ultrices at massa. In sit amet magna sit amet justo convallis tristique. Aenean elementum dignissim purus ut dictum. Integer eget fermentum ante. In hac habitasse platea dictumst. Proin vel interdum neque. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Nulla neque leo, sollicitudin ac vehicula sed, gravida vel ipsum. Pellentesque diam nibh, feugiat sed augue a, molestie scelerisque est. Pellentesque id nisi rhoncus, tempus arcu tristique, posuere tellus. Phasellus ac iaculis neque, ac tempor augue. Suspendisse hendrerit odio non nulla tristique aliquet. Fusce cursus gravida posuere. Etiam sollicitudin sem tempus, vestibulum erat sit amet, blandit neque. Cras elit metus, gravida ac commodo id, cursus a dui. Nunc ut velit mi. Vivamus ut diam nec libero euismod scelerisque. Curabitur eget erat nec purus commodo vestibulum sed vitae purus. Morbi id sapien vitae eros dictum aliquam vitae in metus. Proin consequat fringilla felis et mollis. Aenean metus dui, iaculis cursus feugiat et, placerat vel magna. Ut id dui sed orci sollicitudin suscipit. Vestibulum molestie pretium dui eu lacinia. Aenean diam elit, hendrerit vitae lorem at, cursus elementum nibh. Pellentesque convallis id lorem ac tristique. Morbi sit amet metus hendrerit, dignissim felis id, rutrum sem. Nunc pulvinar tincidunt molestie. Nullam rhoncus, erat quis vehicula rutrum, mauris ex pulvinar lectus, volutpat sollicitudin dolor ligula vitae augue. Quisque sapien nibh, aliquam in hendrerit a, ultricies eget lectus. Nam commodo interdum arcu, quis eleifend metus vulputate ac. Vestibulum ut malesuada odio. Sed in magna sed tellus dictum ultrices. Nam ut leo suscipit, accumsan erat et, molestie velit. Morbi eu dignissim nisl. Donec finibus enim sed sem dictum vestibulum. Aenean tincidunt nisl lacus, ut bibendum lectus bibendum ac. Nulla molestie nisl arcu, eget venenatis urna volutpat malesuada. Aliquam erat volutpat. Nullam tempus nibh in augue lacinia, vel dictum eros tempor. Nunc id urna sit amet quam rutrum tempor sed sed mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus dignissim, posuere lacus eu, dictum lorem. Pellentesque nulla nulla, euismod at fringilla vel, hendrerit at nibh. Duis euismod pellentesque ex a eleifend. Phasellus in enim in lectus viverra consequat. Donec id tellus vel lorem congue semper. Etiam quis arcu quis dolor tempus ultricies eu non ligula. Cras tristique metus massa, in ornare turpis varius vel. Cras faucibus congue ex sed bibendum. Vestibulum ornare nulla quis venenatis bibendum. Nulla facilisi. Integer sed arcu erat. Phasellus gravida enim vel felis pharetra pretium in luctus diam. Duis eleifend viverra risus et condimentum.Aenean lorem tellus, venenatis a justo non, fermentum faucibus nulla. Nullam at ultrices ante, ut euismod neque. Nulla facilisi. Integer massa enim, fringilla sed pharetra vel, elementum ut purus. Pellentesque eget volutpat enim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur at tortor id dui condimentum aliquam in et turpis. Integer eu semper lacus. Nulla consequat enim non luctus ultrices. Vivamus porttitor quam et dui placerat condimentum. Donec eleifend velit vitae sapien dictum fermentum. Nulla egestas sem quis sodales pharetra. Maecenas volutpat ligula sem, nec faucibus elit malesuada ac. Morbi purus nisl, aliquet vitae dolor sit amet, tristique blandit nulla. Duis eleifend augue posuere sem molestie sodales. Aenean at molestie nisl. In posuere, risus cursus pulvinar sagittis, tortor turpis viverra purus, pellentesque faucibus turpis dolor quis odio. Quisque dictum enim mi, et volutpat nulla hendrerit at. Duis aliquam purus eu varius tincidunt. Aliquam ut efficitur est. Sed porta et justo vitae luctus. Etiam consequat leo eu porta rhoncus. Maecenas vel metus sit amet elit eleifend suscipit. Suspendisse efficitur, eros vel iaculis tincidunt, est libero cursus nulla, ac viverra mauris enim ac eros. Morbi condimentum tempor ullamcorper. Proin ornare dignissim efficitur. Nulla ac vehicula velit. Morbi mauris turpis, auctor sed justo nec, suscipit dictum mauris. Pellentesque vel metus vel augue finibus gravida. Donec sed lectus ultrices, lobortis nibh a, elementum tellus. Fusce ac quam finibus, imperdiet orci sit amet, semper est.'

// test('handles multi-frame messages (2-parts test)', async t => {
//   t.plan(1)
//   const fullMessage = multiFrameMessage.slice(0, 10000)
//   const server = await createSocketServer(s => {
//     s.write(JSON.stringify({ text: fullMessage }))
//   })
//   const socket = new SocketSubject(server.path)
//   return new Promise(resolve => {
//     socket.subscribe(msg => {
//       socket.unsubscribe()
//       server.close()
//       t.is(msg.text, fullMessage)
//       resolve()
//     })
//   })
// })

// test('handles multi-frame messages (4-parts test)', async t => {
//   t.plan(1)
//   const server = await createSocketServer(s => {
//     s.write(JSON.stringify({ text: multiFrameMessage }))
//   })
//   const socket = new SocketSubject(server.path)
//   return new Promise(resolve => {
//     socket.subscribe(msg => {
//       socket.unsubscribe()
//       server.close()
//       t.is(msg.text, multiFrameMessage)
//       resolve()
//     })
//   })
// })

// test('handles multiple messages per frame', async t => {
//   t.plan(2)
//   const server = await createSocketServer(s => {
//     s.write(`{"text":"hello"}${EOL}`)
//     s.write(`{"text":"world"}${EOL}`)
//   })
//   const socket = new SocketSubject(server.path)
//   return new Promise(resolve => {
//     let count = 0
//     socket.subscribe(msg => {
//       if (count++ === 0) {
//         t.is(msg.text, 'hello')
//       } else {
//         socket.unsubscribe()
//         server.close()
//         t.is(msg.text, 'world')
//         resolve()
//       }
//     })
//   })
// })
